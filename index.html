<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSVファイル表示</title>
</head>
<body>
  <h1>CSVファイルの内容</h1>
  <div class="event">
    <p>曜日(イベント)を選択</p>
    <div class="event-radio">
      <input type="radio" id="radio1" name="radioButton" value="0">
      <label for="radio1">水曜・日曜(等倍)</label>
    </div>
    <div class="event-radio">
      <input type="radio" id="radio2" name="radioButton" value="1">
      <label for="radio2">月曜・木曜・金曜(1.5倍)</label>
    </div>
    <div class="event-radio">
      <input type="radio" id="radio3" name="radioButton" value="2">
      <label for="radio3">火曜・土曜(2.5倍)</label>
    </div>
    <div class="event-radio">
      <input type="radio" id="radio4" name="radioButton" value="3">
      <label for="radio4">4倍イベント</label>
    </div>
  </div>

  <div class="multi">
    <p class="subject">倍率指定</p>
    <div class="multi-check">
      <input type="checkbox" id="monthly">
      <label for="monthly">マンスリーパス効果(+15%)</label>
    </div>
    <div class="multi-check">
      <input type="checkbox" id="passive">
      <label for="passive">[ごめんねFingers crossed]梅澤美波<br>[まあいいか？]秋元真夏 どちらかを所持(+30%)</label>
    </div>
    <div class="multi-check">
      <input type="text" class="textbox" id="memo" inputmode="decimal">
      <label for="memo">％：メンバーノギメモ効果</label>
    </div>
	  <div class="range-slider">
	    <label for="rangeSlider" class="range-text">上振れ補正</label>	
      <input type="range" id="rangeSlider" min="0" max="5" step="0.5" value="0" oninput="updateRangeValue()">
	    <span class="range-text">+</span>
      <span class="range-label" id="rangeLabel">0</span>
	    <span class="range-text">[%]</span>
    </div>
  </div>
  
  <div class="range">
    <input type="text" class="textbox" id="start" inputmode="decimal">
    <label for="start">開始行</label>
    <input type="text" class="textbox" id="end" inputmode="decimal">
    <label for="end">終了行</label>
  </div>
  
  <div class="switch">
    <input type="checkbox" id="non120">
    <label for="non120">切り替え</label>
  </div>
  
  <button id="btn-csv">開く</button>
  
  <table id="csv-table"></table>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.5/jquery.csv.min.js"></script>
  
  <script>
    function updateRangeValue() {
        var rangeValue = document.getElementById("rangeSlider").value;
        document.getElementById("rangeLabel").innerText = rangeValue;
    }
	  
    $(document).ready(function() {
  var csvFile = "xp1.csv";

  $("#btn-csv").click(function() {
    if ($("#non120").is(":checked")) {
      csvFile = "xp2.csv";
    } else {
      csvFile = "xp1.csv";
    }

    var startRow = parseInt($("#start").val()); // 開始行
    var endRow = parseInt($("#end").val()); // 終了行

    $.ajax({
      url: csvFile,
      dataType: "text",
      success: function(data) {
        var csvData = $.csv.toArrays(data);
        var table = $("#csv-table");
        table.empty(); // テーブルをクリア

        // ヘッダー行の表示
        var headerRow = "<tr>";
        for (var j = 0; j < csvData[0].length; j++) {
          headerRow += "<th>" + csvData[0][j] + "</th>";
        }
        headerRow += "</tr>";
        table.append(headerRow);

        // データ行の表示
        for (var i = startRow; i <= endRow; i++) {
          if (i >= csvData.length) {
            break;
          }
          var row = "<tr>";

          // 倍率の計算
          var R = 1; // ラジオボタンによる倍率
          var M = 0; // マンスリーによる倍率
          var P = 0; // パッシブによる倍率
          var N = 0; // メモによる倍率
          var S = 0; // レンジスライダーによる倍率

          // ラジオボタン
          if ($("#radio1").is(":checked")) {
            R = 1;
          } else if ($("#radio2").is(":checked")) {
            R = 1.5;
          } else if ($("#radio3").is(":checked")) {
            R = 2.5;
          } else if ($("#radio4").is(":checked")) {
            R = 4;
          }

          // マンスリー
          if ($("#monthly").is(":checked")) {
            M = 0.15;
          }

          // パッシブ
          if ($("#passive").is(":checked")) {
            P = 0.3;
          }

          // メモ
          N = parseFloat($("#memo").val());

          // レンジスライダー
          S = parseFloat($("#rangeSlider").val());

          // 倍率を乗算
          for (var j = 1; j < csvData[i].length; j++) {
            var value = parseFloat(csvData[i][j]);
            value = value * (R * (1 + M + P + (N / 100) + (S / 100)));
            value = Math.floor(value); // 小数点以下切り捨て
            row += "<td>" + value + "</td>";
          }

          row += "</tr>";
          table.append(row);
        }
      }
    });
  });
});
  </script>
  <style>
    table {
      border-collapse: collapse;
      width: 50%;
      height: 50%;
    }
    th, td {
      border: 1px solid black;
      padding: 5px;
    }
  </style>
</body>
</html>
